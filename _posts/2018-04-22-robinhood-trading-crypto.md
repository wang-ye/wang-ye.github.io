In the [previous post](/2018/04/04/robinhood-api.html), I discussed several Robinhood Crypto API endpoints including quotes, currency pairs and price history. Recently Robinhood opened the Web version for Crypto trading and uncovered the trading/order endpoints. In this post I will cover these endpoints as well as how Robinhood generated the Auth2 tokens.

## Robinhood Access Token
As illustrated in the previous post, we can get Auth2 token by calling migrate_token endpoint. There is an easier way to get Auth2 token - 
calling */auth2/token/* endpoint directly.

```bash
curl -L -v -X POST "https://api.robinhood.com/oauth2/token/" \
   -H "Content-Type: application/json" \
   -d '{"grant_type":"password","scope":"internal", \
        "client_id":"c82SH0WZOsabOXGP2sxqcj34FxkvfnWRZBKlBjFS", \
        "expires_in":86400,"username":"your_email","password":"your_password"}'
```

By calling the above *Oauth2* endpoint, we get the following response:

```json
{
  "backup_code": null,
  "access_token": "access_token",
  "expires_in": 86400,
  "mfa_code": null,
  "token_type": "Bearer",
  "scope": "internal",
  "refresh_token": "refresh_token"
}
```

Here the access token is what we need for authorization, while the refresh tokens can be used to [regain access](https://auth0.com/learn/refresh-tokens/).

## Accounts
The API to uncover accounts info is `https://nummus.robinhood.com/accounts`.

```bash
curl -L -v -X POST "https://nummus.robinhood.com/accounts/" \
   -H "Accept: application/json" \
   -H "Content-Type: application/json" \
   -H "Authorization: Bearer access_token" \
```

You can get the account id from the response. Give it a try!


## Trade Endpoints
Now comes the endpoint to submit orders! The API endpoint is `https://nummus.robinhood.com/orders/`.

```bash
curl -L -v -X POST "https://nummus.robinhood.com/orders/" \
   -H "Accept: application/json" \
   -H "Content-Type: application/json" \
   -H "Authorization: Bearer access_token" \
   -d '{"account_id" : "your_account_id",
        "currency_pair_id" : "3d961844-d360-45fc-989b-f6fca761d511",
        "price" : "9028.67", "quantity" : "0.00011186",
        "ref_id" : "uuid4", "side" : "buy",
        "time_in_force" : "gtc", "type" : "market"}'
```

Note the trailing '/' in the URL. Missing it will cause an **301 Moved Permenately** error. The currency pair id indicates it is a 'BTCUSD' pair. Another thing worth noting is the *ref_id*: it is a random string generated by UUID4. The response is as follows:

```json
{
  "account_id": "your_account_id",
  "cancel_url": "https:\/\/nummus.robinhood.com\/orders\/{order_id}\/cancel\/",
  "created_at": "2018-04-24T03:01:57.162119-04:00",
  "cumulative_quantity": "0.000000000000000000",
  "currency_pair_id": "3d961844-d360-45fc-989b-f6fca761d511",
  "executions": [],
  "id": "order_id",
  "last_transaction_at": null,
  "price": "9028.67",
  "quantity": "0.00011186",
  "ref_id": "uuid4_id",
  "side": "buy",
  "state": "unconfirmed",
  "time_in_force": "gtc",
  "type": "market",
  "updated_at": "2018-04-24T03:01:57.317252-04 .."
}
```

Order id is needed for order status query.

## Check order status
Robinhood also provides the API for checking order status.

```bash
curl -L -v "https://nummus.robinhood.com/orders/{order_id}" \
   -H "Accept: application/json" \
   -H "Content-Type: application/json" \
   -H "Authorization: Bearer access_token"
```

The response is very similar to the trade API. Omitted to save space.

## Retrieve Trade History
Directly *GET* */orders/* API will give you all Crypto trading history. Note that this API is paginated.

```bash
curl -L -v "https://nummus.robinhood.com/orders/" \
   -H "Content-Type: application/json" \
   -H "Authorization: Bearer access_token"
```

This will give you a whole trade history. Omitted the response to save space.

## Summary
This post discusses the various order/trading related Robinhood APIs. I will open source the API in Python soon.